<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPS</title>
    <link rel="stylesheet" href="../assets/css/bootstrap.css">
    <link rel="stylesheet" href="assets/vendors/chartjs/Chart.min.css">
    <link rel="stylesheet" href="assets/vendors/perfect-scrollbar/perfect-scrollbar.css">
    <link rel="stylesheet" href="../assets/css/app.css">
    <link rel="shortcut icon" href="assets/images/favicon.svg" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.9.0/dist/sweetalert2.min.css" rel="stylesheet">
</head>

<body>
    <div id="app">
        <nav>
            <div id="contenedor-nav">
                <div id="contenedor-left">
                    <h4>EPS</h4>
                </div>
                <div id="contenedor-right">
                    <div class="dropdown">
                        <button class="dropbtn">User Action
                            <i class="fa fa-caret-down"></i>
                        </button>
                        <div class="dropdown-content">
                            <a href="formularioUsuario.html">Update Data Personal</a>
                            <a href="facturas.html">Check Bills</a>
                        </div>
                    </div>
                    <a href="#home">appointments</a>
                    <a href="#about">PQR</a>

                </div>
            </div>
        </nav>
        <div class="main-content container-fluid">
            <section class="section">
                <div class="row mb-8">
                    <div class="col-md-12">
                        <div class="card">
                            <div class="card-header d-flex justify-content-between">
                                <h3 class='card-heading p-1 pl-3'>User Data Form</h3>
                                <i data-feather="user-check" class="iconos-user" style="font-size: 30px; "></i>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-12 col-12">
                                        <form action="" id="formularioUsuario">
                                            <div class="row">
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Name: </strong> </label>
                                                        <input type="text"
                                                            class="form-control form-input-style  grupo_nombre"
                                                            id="grupo_nombre" name="nombre"
                                                            placeholder="Digita tu nombre">
                                                        <small id="mensaje_input_nombre">You should not type numbers or
                                                            special characters</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Second Name: </strong> </label>
                                                        <input type="text"
                                                            class="form-control form-input-style grupo_segundo_nombre"
                                                            id="grupo_segundo_nombre" name="segundo_nombre"
                                                            placeholder="Digita tu segundo nombre">
                                                        <small id="mensaje_input_segundo_nombre">You should not type
                                                            numbers or special characters</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>LastName: </strong></label>
                                                        <input type="text"
                                                            class="form-control form-input-style infoUsuarioActualizar"
                                                            id="grupo_apellido" name="apellido"
                                                            placeholder="digita tu apellido">
                                                        <small id="mensaje_input_apellido">You should not type numbers
                                                            no special characters</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Identification Type: </strong></label>
                                                        <select name="" id="typeIdent"
                                                            class="form-control infoUsuarioActualizar form-select">
                                                            <option value="identitycard">Identity Card</option>
                                                            <option value="CC">ID Card</option>
                                                            <option value="passport">Passport</option>
                                                            <option value="CE">Foreign Id</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Identification Number: </strong>
                                                        </label>
                                                        <input type="number"
                                                            class="form-control form-input-style infoUsuarioActualizar"
                                                            id="grupo_numident" name="numident"
                                                            placeholder="Digita tu No Identificacion">
                                                        <small id="mensaje_input_numident">It must not contain letters,
                                                            it must be between 7 and 12 characters</small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Phone: </strong> </label>
                                                        <input type="number"
                                                            class="form-control form-input-style infoUsuarioActualizar"
                                                            id="grupo_telefono" name="telefono"
                                                            placeholder="Digita tu numero de telofono">
                                                        <small id="mensaje_input_telefono">They must contain a minimum
                                                            of 7 and a maximum of 14 numbers.</small>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Residence Adress: </strong>
                                                        </label>
                                                        <input type="text"
                                                            class="form-control form-input-style infoUsuarioActualizar"
                                                            id="dirResidencia" placeholder="Digita tu Direccion">
                                                        <small id="mensaje_input_nombre"></small>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Country: </strong> </label>
                                                        <input type="text" class="form-control infoUsuarioActualizar"
                                                            id="paisUsuario" placeholder="Digita pais">
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>City: </strong> </label>
                                                        <input type="text" class="form-control infoUsuarioActualizar"
                                                            id="ciudadUsuario" placeholder="Digita ciudad">
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Code Postal: </strong> </label>
                                                        <input type="text"
                                                            class="form-control form-input-style infoUsuarioActualizar"
                                                            id="codPostal" placeholder="Digita codigo postal">
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="row">
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group">
                                                        <label for=""><strong>Gender: </strong> </label>
                                                        <select name="" id="genderUser"
                                                            class="form-control infoUsuarioActualizar form-select">
                                                            <option value="">select an option</option>
                                                            <option value="m">Male</option>
                                                            <option value="f">Female</option>
                                                            <option value="na">Prefiero no escoger</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                <div class="col-md-4 col-2">
                                                    <div class="form-group" id="divRemove">
                                                        <label for=""><strong>Sisben: </strong> </label>
                                                        <select name="" id="sisben"
                                                            class="form-control infoUsuarioActualizar form-select">
                                                            <option value="">select an option</option>
                                                            <option value="1">Yes</option>
                                                            <option value="0">No</option>
                                                        </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            <div class="card-footer">
                                <button type="button" class="btn btn-primary" onclick="update()" id="updateUser">Update
                                    Data <i data-feather="edit"></i> </button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </div>
    <script src="../assets/js/feather-icons/feather.min.js"></script>
    <script src="../assets/js/jquery-3.7.1.min.js"></script>
    <script src="../assets/js/main.js"></script>
    <script src="../assets/js/validarFormulario.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.9.0/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <script>
        const url = 'http://localhost:3000/affiliate';
        const urlAffiliate = 'http://localhost:3000/affiliate?id=123456789';

        const gender = {
            male: 'm',
            female: 'f',
            other: 'na'
        }

        const genderMapper = {
            m: 'male',
            f: 'female',
            na: 'other'
        }

        const identificationType = {
            citizenId: 'CC',
            foreignId: 'CE',
            passport: 'passport',
            identityCard: 'identityCard'
        }

        const identificationTypeMapper = {
            CC: 'citizenId',
            CE: 'foreignId',
            passport: 'passport',
            identityCard: 'identityCard'
        }

        const update = async () => {
            updateUser.name = jQuery('#grupo_nombre').val();
            updateUser.middleName = jQuery('#grupo_segundo_nombre').val();
            updateUser.id = jQuery('#grupo_numident').val();
            updateUser.address = jQuery('#dirResidencia').val();
            updateUser.city = jQuery('#ciudadUsuario').val();
            updateUser.country = jQuery('#paisUsuario').val();
            updateUser.postalCode = jQuery('#codPostal').val();
            updateUser.lastNames = jQuery('#grupo_apellido').val();
            updateUser.cellPhoneNumber = jQuery('#grupo_telefono').val();
            updateUser.sisben = jQuery('#sisben').val() === 1 ? true : false;
            updateUser.gender = genderMapper[jQuery('#genderUser').val()];
            updateUser.identificationType = identificationTypeMapper[jQuery('#typeIdent').val()];
            
            try {
                await axios.patch(url, updateUser);
                location.reload();
            } catch (error) {
                Swal.fire({
                    position: 'center',
                    icon: 'danger',
                    title: error.message,
                    showConfirmButton: false,
                    timer: 1500
                });
            }
        }

        const updateUser = {
            name: undefined,
            middleName: undefined,
            lastNames: undefined,
            birthdate: undefined,
            identificationType: undefined,
            id: undefined,
            phoneNumber: undefined,
            cellPhoneNumber: undefined,
            postalCode: undefined,
            address: undefined,
            country: undefined,
            city: undefined,
            email: undefined,
            gender: undefined,
            status: undefined,
            socialStratum: undefined,
            sisben: undefined,
            requiresCompany: undefined
        }

        jQuery(document).ready(async () =>  {
            const response = await axios.get(urlAffiliate);
            updateUser.phoneNumber = response.data.phoneNumber;
            updateUser.email = response.data.email;
            updateUser.status = response.data.status;
            updateUser.socialStratum = response.data.socialStratum;
            updateUser.requiresCompany = response.data.requiresCompany;
            updateUser.birthdate = response.data.birthdate;

            jQuery('#grupo_nombre').val(response.data.name);
            jQuery('#grupo_segundo_nombre').val(response.data.middleName);
            jQuery('#grupo_numident').val(response.data.id);
            jQuery('#dirResidencia').val(response.data.address);
            jQuery('#ciudadUsuario').val(response.data.city);
            jQuery('#paisUsuario').val(response.data.country);
            jQuery('#codPostal').val(response.data.postalCode);
            jQuery('#grupo_apellido').val(response.data.lastNames);
            jQuery('#grupo_telefono').val(response.data.cellPhoneNumber);
            jQuery('#sisben').val(response.data.sisben === true ? 1 : 0);
            jQuery('#genderUser').val(gender[response.data.gender]);
            jQuery('#typeIdent').val(identificationType[response.data.identificationType]);
        });

        jQuery('.dropbtn').hover(function () {
            jQuery('.dropdown-content').css('display', 'block');
        })

        jQuery('.dropdown-content').hover(function () {
            jQuery('.dropdown-content').css('display', 'block');
        })

        jQuery('.dropbtn').on('mouseleave', function () {
            jQuery('.dropdown-content').css('display', 'none');
        })

        jQuery('.dropdown-content').on('mouseleave', function () {
            jQuery('.dropdown-content').css('display', 'none');
        })

    </script>
</body>

</html>